{% extends 'documentos/documento_list.html' %}

{% load comments %}

{% block extra_head %}
	<script type="text/javascript">
		$(function() {
			
			$("#vote_up").click(function(event) {
				event.preventDefault();
				
				$.getJSON('upvote', function(exito) {
					if (exito) {
						dom_number_of_votes = $("#number_of_votes_up");
						dom_number_of_votes.html(Number(dom_number_of_votes.text()) + 1);
					}
				});
			});
			
			$("#vote_down").click(function(event) {
				event.preventDefault();
				
				$.getJSON('downvote', function(exito) {
					if (exito) {
						dom_number_of_votes = $("#number_of_votes_down");
						dom_number_of_votes.html(Number(dom_number_of_votes.text()) + 1);
					}
				});
			});
		});
	</script>
{% endblock %}

{% block content %}

<h3>Documento:</h3>

<div id="datos_documento">
	<fieldset>
		<p><label>TÃ­tulo:</label></p><p>{{ documento.titulo }}</p><p/>
		<p><label>Autor:</label></p><p>{{ documento.autor }}</p><p/>
		<p><label>Tipo de documento:</label></p><p>{{ documento.get_tipo_display }}</p><p/>
		{% if documento.carrera.all %}<p><label>Carrera:</label></p><p>{% for carrera in documento.carrera.all %} {{ carrera }}{% if not forloop.last %}; {% endif %}{% endfor %}</p><p/>{% endif %}
		{% if documento.materia.all %}<p><label>Materia:</label></p><p>{% for materia in documento.materia.all %} {{ materia  }}{% if not forloop.last %}; {% endif %}{% endfor %}</p><p/>{% endif %}
		
		<p><label>Link:</label></p><p><a href="{{ documento.link  }}">{{ documento.link  }}</a></p><p/>
		{% if documento.mirror %}<p><label>Mirror:</label></p><p><a href="{{ documento.mirror  }}">{{ documento.mirror  }}</a></p><p/>{% endif %}
		<p><label>Subido por:</label></p><p>{{ documento.subido_por }}</p><p/>
		
		<p><label>Detalles:</label></p><p>{{ documento.detalles }}</p><p/>
	</fieldset>
</div>

<div id="votacion">
	<p id="number_of_votes_up">6</p> <a id="vote_up" href="#">Vote up</a>
	<br/>
	<p id="number_of_votes_down">5</p> <a id="vote_down" href="#">Vote down</a>
</div>

<h3>Comentarios:</h3>

<br/>

{% get_comment_count for documento as number_of_comments %}

<p>Este documento posee {{ number_of_comments }} comentarios.</p>

<br/><br/>

<div id="comentarios">
	{% get_comment_list for documento as comment_list %}
		
	{% for comment in comment_list %}
		<hr>
		<p><strong>{{ comment.user_name }}</strong> dice:</p><br>
		<p><em>{{ comment.comment|safe }}</em></p><br>
		<p>{{ comment.submit_date|date:"D d M Y g:i a" }}</p><br>
		
		{% if forloop.last %}<hr>{% endif %}
	{% endfor %}
</div>

<br/><br/>

{% get_comment_form for documento as form %}

<h3>Agregue un comentario:</h3>

{% include 'comments/form_add_comment.html' with next=request.path %}

{% endblock %}